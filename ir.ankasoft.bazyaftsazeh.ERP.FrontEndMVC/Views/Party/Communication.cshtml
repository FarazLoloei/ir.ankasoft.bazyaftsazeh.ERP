@using ir.ankasoft.bazyaftsazeh.ERP.FrontEndMVC.Models.Party
@model ViewModelPartyCommunication


<div class="content-heading">
    @Resource.CounterParty
    <small>
        @Html.AnkaResource(model => model.PersonalTitle) @Model.Title - @Model.NationalCode#
    </small>
</div>

<div class="row">
    <div class="col-lg-9">
        @using (Html.BeginForm(MVC.Party.Communication(), FormMethod.Post))
        {
            @Html.AntiForgeryToken()
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">@Resource.EditCommunication</div>
                </div>
                <div class="panel-body">
                    <div class="form-horizontal">
                        @Html.HiddenFor(model => model.recId)
                        <div class="clearfix">
                            <div class="pull-right">
                                <button type="button" class="btn btn-labeled btn-success" onclick="Add();">
                                    <span class="btn btn-label">
                                        <i class="fa fa-plus"></i>
                                    </span>@Resource.Add
                                </button>

                                @*<button type="button" class="btn btn-labeled btn-danger buttonRemoveCommunication">
                                        <span class="btn btn-label">
                                            <i class="fa fa-minus"></i>
                                        </span>@Resource.Remove
                                    </button>*@
                            </div>
                        </div>
                        <div class="communications">
                            <table class="table anka_dataTable table-striped table-bordered">
                                @Html.Partial(MVC.Communication.Views._Repeater, Model.CommunicationCollection)
                            </table>
                        </div>
                    </div>
                </div>

                <div class="panel-footer">
                    <div class="clearfix">
                        <div class="pull-right">
                            @*<button class="btn btn-primary" type="submit">@Resource.Edit</button>*@
                            @Html.ActionLink(Resource.Return, null, null, null, new { href = Request.UrlReferrer, @class = "btn btn-warning" })
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section scripts{
    @Scripts.Render(Bundles.Scripts.sweetAlert)
    <script type="text/javascript">
        $(document).ready(function () {
        });
        function Operation($this, url) {

            var communication = $('.communications');
            var selector = $this.closest('tr.master');
            if ($this == null)
                selector = communication;//$('.communications');
            var serializedValues = selector.find('input, select').serializeArray();
            $.ajax({
                url: url,
                contentType: 'application/html; charset=utf-8',
                type: 'GET',
                dataType: 'html',
                data: serializedValues,
                success: function (result) {
                    console.info(result);

                    communication.find('table').html(result);
                    recreateSelect2(communication);
                },
                error: function (xhr, status) {
                    swal("@Resource.Cancelled ", status, "error");
                }
            });
        }

        @*function EditCommunication($this, url, index) {
            var selector = 
            var communication = $this.closest('tr.master');//$('.communications');
            var serializedValues = communication.find('input, select').serializeArray();
            //alert(serializedValues);
            $.ajax({
                url: url,
                contentType: 'application/html; charset=utf-8',
                type: 'GET',
                dataType: 'html',
                data: serializedValues,
                success: function (result) {
                    communication.find('table').html(result);
                    recreateSelect2(communication);
                },
                error: function (xhr, status) {
                    swal("@Resource.Cancelled ", status, "error");
                }
            });
        }*@



        function Add(){
            var communication = $('.communications');
            var myUrl = '@Url.JavaScriptReplaceableUrl(MVC.Party.CommunicationDetail())';
            var Url = '@Url.Action(MVC.Party.CommunicationDetail())';
            var serializedValues = communication.find('input, select').serializeArray();
            if (communication.find('input').length < 1)
                Url = myUrl;
            $.ajax({
                url: Url,
                contentType: 'application/html; charset=utf-8',
                type: 'GET',
                dataType: 'html',
                data: serializedValues,
                success: function (result) {
                    communication.find('table').html(result);
                    recreateSelect2(communication);
                },
                error: function (xhr, status) {
                    swal("@Resource.Cancelled ", status, "error");
                }
            });
        }
        function Remove($this) {
            var tr = $this.closest('tr.master');
            tr.remove();
        }

        function showInlineEditor($this) {
            var tr = $this.closest('tr.master');
            tr.addClass('hidden');
            $('tr.editor_' + tr.attr('data-itemid')).removeClass('hidden');
        }
        function undoInlineEditor($this) {
            var tr = $this.closest('tr.master');
            tr.addClass('hidden');
            $('tr.display_' + tr.attr('data-itemid')).removeClass('hidden');
        }

        function removeOnTheFly($this) {
            var tr = $this.closest('tr.master');
            tr.remove();
        }
    </script>
}