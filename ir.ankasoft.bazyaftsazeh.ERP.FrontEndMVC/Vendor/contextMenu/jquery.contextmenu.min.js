(function(n){n.contextMenu={shadow:!0,shadowOffset:0,shadowOffsetX:5,shadowOffsetY:5,shadowWidthAdjust:-3,shadowHeightAdjust:-3,shadowOpacity:.2,shadowClass:"context-menu-shadow",shadowColor:"black",offsetX:0,offsetY:0,appendTo:"body",direction:"down",constrainToScreen:!0,showTransition:"show",hideTransition:"hide",showSpeed:null,hideSpeed:null,showCallback:null,hideCallback:null,className:"context-menu",itemClassName:"context-menu-item",itemHoverClassName:"context-menu-item-hover",disabledItemClassName:"context-menu-item-disabled",disabledItemHoverClassName:"context-menu-item-disabled-hover",separatorClassName:"context-menu-separator",innerDivClassName:"context-menu-item-inner",themePrefix:"context-menu-theme-",theme:"default",separator:"context-menu-separator",target:null,menu:null,shadowObj:null,bgiframe:null,shown:!1,useIframe:!1,create:function(t,i){var r=n.extend({},this,i);return typeof t=="string"?r.menu=n(t):typeof t=="function"?r.menuFunction=t:r.menu=r.createMenu(t,r),r.menu&&(r.menu.css({display:"none"}),n(r.appendTo).append(r.menu)),r.shadow&&(r.createShadow(r),r.shadowOffset&&(r.shadowOffsetX=r.shadowOffsetY=r.shadowOffset)),n("body").bind("contextmenu",function(){r.hide()}),r},createIframe:function(){return n('<iframe frameborder="0" tabindex="-1" src="javascript:false" style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=0);"/>')},createMenu:function(t,i){var e=i.className,r,h,f;n.each(i.theme.split(","),function(n,t){e+=" "+i.themePrefix+t});var o=n("<table cellspacing=0 cellpadding=0><\/table>").click(function(){return i.hide(),!1}),c=n("<tr><\/tr>"),s=n("<td><\/td>"),u=n('<div class="'+e+'"><\/div>');for(r=0;r<t.length;r++)if(h=t[r],h==n.contextMenu.separator)u.append(i.createSeparator());else for(f in t[r])u.append(i.createMenuItem(f,t[r][f]));return i.useIframe&&s.append(i.createIframe()),o.append(c.append(s.append(u))),o},createMenuItem:function(t,i){var r=this;typeof i=="function"&&(i={onclick:i});var u=n.extend({onclick:function(){},className:"",hoverClassName:r.itemHoverClassName,icon:"",disabled:!1,title:"",hoverItem:r.hoverItem,hoverItemOut:r.hoverItemOut},i),e=u.icon?"background-image:url("+u.icon+");":"",f=n('<div class="'+r.itemClassName+" "+u.className+(u.disabled?" "+r.disabledItemClassName:"")+'" title="'+u.title+'"><\/div>').click(function(n){return r.isItemDisabled(this)?!1:u.onclick.call(r.target,this,r,n)}).hover(function(){u.hoverItem.call(this,r.isItemDisabled(this)?r.disabledItemHoverClassName:u.hoverClassName)},function(){u.hoverItemOut.call(this,r.isItemDisabled(this)?r.disabledItemHoverClassName:u.hoverClassName)}),o=n('<div class="'+r.innerDivClassName+'" style="'+e+'">'+t+"<\/div>");return f.append(o),f},createSeparator:function(){return n('<div class="'+this.separatorClassName+'"><\/div>')},isItemDisabled:function(t){return n(t).is("."+this.disabledItemClassName)},hoverItem:function(t){n(this).addClass(t)},hoverItemOut:function(t){n(this).removeClass(t)},createShadow:function(t){t.shadowObj=n('<div class="'+t.shadowClass+'"><\/div>').css({display:"none",position:"absolute",zIndex:9998,opacity:t.shadowOpacity,backgroundColor:t.shadowColor});n(t.appendTo).append(t.shadowObj)},showShadow:function(n,t){var i=this;i.shadow&&i.shadowObj.css({width:i.menu.width()+i.shadowWidthAdjust+"px",height:i.menu.height()+i.shadowHeightAdjust+"px",top:t+i.shadowOffsetY+"px",left:n+i.shadowOffsetX+"px"}).addClass(i.shadowClass)[i.showTransition](i.showSpeed)},beforeShow:function(){return!0},show:function(t,i){var r=this,e=i.pageX,o=i.pageY,u,f;if(r.target=t,r.beforeShow()!==!1){r.menuFunction&&(r.menu&&n(r.menu).remove(),r.menu=r.createMenu(r.menuFunction(r,t),r),r.menu.css({display:"none"}),n(r.appendTo).append(r.menu));u=r.menu;e+=r.offsetX;o+=r.offsetY;f=r.getPosition(e,o,r,i);r.showShadow(f.x,f.y,i);r.useIframe&&u.find("iframe").css({width:u.width()+r.shadowOffsetX+r.shadowWidthAdjust,height:u.height()+r.shadowOffsetY+r.shadowHeightAdjust});u.css({top:f.y+"px",left:f.x+"px",position:"absolute",zIndex:9999})[r.showTransition](r.showSpeed,r.showCallback?function(){r.showCallback.call(r)}:null);r.shown=!0;n(document).one("click",null,function(){r.hide()})}},getPosition:function(t,i,r){var f=t+r.offsetX,e=i+r.offsetY,h=n(r.menu).height(),l=n(r.menu).width(),o=r.direction,s;if(r.constrainToScreen){var u=n(window),a=u.height(),c=u.width();o=="down"&&e+h-u.scrollTop()>a&&(o="up");s=f+l-u.scrollLeft();s>c&&(f-=s-c)}return o=="up"&&(e-=h),{x:f,y:e}},hide:function(){var t=this;t.shown&&(t.iframe&&n(t.iframe).hide(),t.menu&&t.menu[t.hideTransition](t.hideSpeed,t.hideCallback?function(){t.hideCallback.call(t)}:null),t.shadow&&t.shadowObj[t.hideTransition](t.hideSpeed));t.shown=!1}};n.fn.contextMenu=function(t,i){var r=n.contextMenu.create(t,i);return this.each(function(){n(this).bind("contextmenu",function(n){return r.show(this,n),!1})})}})(jQuery);